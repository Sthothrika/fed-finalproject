<h1 class="mb-4"><%= typeof title !== 'undefined' ? title : 'All Health Resources' %></h1>
<div class="row">
  <% if (!resources || resources.length === 0) { %>
    <div class="col-12">
      <div class="alert alert-info">No resources found.</div>
    </div>
  <% } %>
  <% resources.forEach(function(r){ %>
    <div class="col-md-6 mb-4">
      <div class="card h-100 shadow-sm">
        <div class="row g-0">
          <div class="col-md-4">
            <div class="resource-icon-wrap" data-category="<%= r.category %>" title="Click for category info" style="cursor:pointer;">
              <img src="/images/icons/<%= r.category %>.svg" class="resource-icon-img" alt="<%= r.title %> icon" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
              <div class="resource-icon-fallback" style="display:none">
                <% if (r.category === 'mental-health') { %>
                  <!-- chat / counseling icon fallback -->
                  <svg class="resource-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <rect x="2" y="3" width="20" height="14" rx="3" fill="url(#g1)" />
                    <path d="M8 19l3-3 3 3" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <defs><linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#1e88ff"/><stop offset="1" stop-color="#06b6d4"/></linearGradient></defs>
                  </svg>
                <% } else if (r.category === 'program') { %>
                  <!-- program / fitness icon fallback -->
                  <svg class="resource-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <rect x="3" y="7" width="18" height="4" rx="1" fill="url(#g2)" />
                    <rect x="3" y="13" width="18" height="4" rx="1" fill="url(#g2)" />
                    <defs><linearGradient id="g2" x1="0" x2="1"><stop offset="0" stop-color="#1e88ff"/><stop offset="1" stop-color="#06b6d4"/></linearGradient></defs>
                  </svg>
                <% } else if (r.category === 'nutrition') { %>
                  <!-- nutrition / apple icon fallback -->
                  <svg class="resource-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path d="M16 7c0-1.7-1.3-3-3-3s-3 1.3-3 3c0 0 .9 1.8 3 1.8S16 7 16 7z" fill="url(#g3)"/>
                    <path d="M12 9c-3.3 0-6 2.7-6 6 0 2.2 1.3 3.7 3 4.5 1.4.7 2.8.5 3 0 .2.5 1.6.7 3 0 1.7-.8 3-2.3 3-4.5 0-3.3-2.7-6-6-6z" fill="url(#g3)"/>
                    <defs><linearGradient id="g3" x1="0" x2="1"><stop offset="0" stop-color="#34d399"/><stop offset="1" stop-color="#10b981"/></linearGradient></defs>
                  </svg>
                <% } else if (r.category === 'yoga') { %>
                  <!-- yoga icon fallback -->
                  <svg class="resource-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <circle cx="12" cy="8" r="3" fill="url(#g4)"/>
                    <path d="M4 20s4-6 8-6 8 6 8 6" fill="none" stroke="url(#g4)" stroke-width="1.5" stroke-linecap="round"/>
                    <defs><linearGradient id="g4" x1="0" x2="1"><stop offset="0" stop-color="#a78bfa"/><stop offset="1" stop-color="#06b6d4"/></linearGradient></defs>
                  </svg>
                <% } else { %>
                  <!-- default icon fallback -->
                  <svg class="resource-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <rect x="3" y="3" width="18" height="18" rx="3" fill="url(#g5)"/>
                    <defs><linearGradient id="g5" x1="0" x2="1"><stop offset="0" stop-color="#cbd5e1"/><stop offset="1" stop-color="#e2e8f0"/></linearGradient></defs>
                  </svg>
                <% } %>
              </div>
            </div>
          </div>
          <div class="col-md-8">
            <div class="card-body d-flex flex-column">
              <div class="d-flex justify-content-between align-items-start">
                <h5 class="card-title mb-1"><%= r.title %></h5>
                <span class="badge bg-light text-primary small"><%= (r.category || 'general').replace('-', ' ') %></span>
              </div>
              <p class="card-text text-muted small"><%= r.description.length > 200 ? r.description.substring(0,200)+"..." : r.description %></p>
              <div class="resource-extra" style="display:none; border-left:3px solid #eef2ff; padding:12px; margin-top:8px; background:#fbfdff;">
                <% if (r.category === 'mental-health') { %>
                  <p class="small text-muted mb-1"><strong>How to access counseling:</strong> Book appointments or check drop-in hours. If in crisis, contact emergency services or the campus crisis line.</p>
                <% } else if (r.category === 'program') { %>
                  <p class="small text-muted mb-1"><strong>Program highlights:</strong> Weekly classes, coaching, and plans for all levels.</p>
                <% } else if (r.category === 'nutrition') { %>
                  <p class="small text-muted mb-1"><strong>Nutrition tip:</strong> Try balanced plates — protein + veg + whole grains. Schedule an advising session for tailored plans.</p>
                <% } else if (r.category === 'yoga') { %>
                  <p class="small text-muted mb-1"><strong>Yoga:</strong> Gentle sequences for beginners. See the resource page for a guided video.</p>
                <% } else if (r.category === 'health-tip' || r.category === 'daily-routine') { %>
                  <p class="small text-muted mb-1"><strong>Daily routine ideas:</strong> Short morning stretches, midday walk, and evening relaxation.</p>
                <% } else { %>
                  <p class="small text-muted mb-1">More information available on the resource page.</p>
                <% } %>
                <div class="small text-muted mt-2">Link: <% if (r.link && r.link !== '#') { %><a href="<%= r.link %>" target="_blank"><%= r.link %></a><% } else { %>N/A<% } %></div>
              </div>
              <div class="mt-auto d-flex justify-content-between align-items-center">
                <div>
                  <a href="/resources/<%= r.id %>" class="btn btn-sm btn-primary me-2">Open</a>
                  <button type="button" class="btn btn-sm btn-outline-secondary toggle-info">More info</button>
                </div>
                <span class="text-muted small">Views: <%= r.views || 0 %></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% }) %>
</div>

<!-- Category info modal (simple) -->
<div id="categoryInfoModal" class="category-modal" aria-hidden="true">
  <div class="category-modal-backdrop" id="categoryModalBackdrop"></div>
  <div class="category-modal-dialog" role="dialog" aria-modal="true" aria-labelledby="categoryModalTitle">
    <div class="category-modal-header">
      <h5 id="categoryModalTitle">Category</h5>
      <button id="categoryModalClose" class="btn-close" aria-label="Close">×</button>
    </div>
    <div class="category-modal-body">
      <p id="categoryModalDesc"></p>
    </div>
  </div>
</div>

<style>
.category-modal{display:none;position:fixed;inset:0;z-index:1050;}
.category-modal.open{display:block}
.category-modal-backdrop{position:fixed;inset:0;background:rgba(15,23,42,0.5)}
.category-modal-dialog{position:relative;max-width:640px;margin:6% auto;background:white;border-radius:8px;box-shadow:0 10px 30px rgba(2,6,23,0.2);padding:16px}
.category-modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.category-modal-body{color:#374151}
.btn-close{background:none;border:none;font-size:20px;line-height:1;color:#6b7280;cursor:pointer}
</style>

<script>
  (function(){
    const info = {
      'mental-health': { title: 'Mental Health & Counseling', desc: 'Confidential counseling services, crisis support, and mental health resources to help you manage stress, anxiety, and wellbeing. Includes appointments and drop-in hours.' },
      'program': { title: 'Wellness Programs', desc: 'Structured programs such as fitness classes, group workshops, and guided courses to build healthy habits and stay active.' },
      'nutrition': { title: 'Nutrition & Meal Planning', desc: 'Nutrition advising, meal planning support, and workshops to help you build affordable, balanced eating habits suited for student life.' },
      'yoga': { title: 'Yoga & Mindfulness', desc: 'Beginner-friendly yoga sequences and mindfulness practices to improve flexibility, reduce stress, and support restful sleep.' },
      'general': { title: 'General Resource', desc: 'General campus resources and links to support student health and wellbeing.' }
    };
    function showModal(category){
      const modal = document.getElementById('categoryInfoModal');
      const titleEl = document.getElementById('categoryModalTitle');
      const descEl = document.getElementById('categoryModalDesc');
      const meta = info[category] || info['general'];
      titleEl.textContent = meta.title;
      descEl.textContent = meta.desc;
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
    }
    function hideModal(){
      const modal = document.getElementById('categoryInfoModal');
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
    }
    document.addEventListener('click', function(e){
      const wrap = e.target.closest && e.target.closest('.resource-icon-wrap');
      if(wrap){
        const category = wrap.getAttribute('data-category') || 'general';
        showModal(category);
      }
    });
    document.getElementById('categoryModalClose').addEventListener('click', hideModal);
    document.getElementById('categoryModalBackdrop').addEventListener('click', hideModal);
    document.addEventListener('keydown', function(e){ if(e.key === 'Escape') hideModal(); });
    // Toggle inline card details
    document.querySelectorAll('.toggle-info').forEach(btn => {
      btn.addEventListener('click', function(){
        const card = btn.closest('.card');
        const extra = card.querySelector('.resource-extra');
        if(!extra) return;
        if(extra.style.display === 'none' || extra.style.display === '') {
          extra.style.display = 'block';
          btn.textContent = 'Less info';
        } else {
          extra.style.display = 'none';
          btn.textContent = 'More info';
        }
      });
    });
  })();
</script>
